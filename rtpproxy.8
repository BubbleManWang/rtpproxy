.\"Generated by db2man.xsl. Don't modify this, modify the source.
.de Sh \" Subsection
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.TH "RTPPROXY" 8 "Feb 20, 2006" "" ""
.SH NAME
rtpproxy \- RTP (Real-time Transport Protocol) Proxy Server
.SH "SYNOPSIS"
.ad l
.hy 0
.HP 9
\fBrtpproxy\fR [\fB\-?\fR] [\fB\-2\fR] [\fB\-f\fR] [\fB\-v\fR] [\fB\-R\fR] [\fB\-l\fR\ \fIaddr1[/addr2]\fR] [\fB\-6\fR\ \fIaddr1[/addr2]\fR] [\fB\-s\fR\ \fIctrl_socket\fR] [\fB\-t\fR\ \fItos\fR] [\fB\-p\fR\ \fIpidfile\fR] [\fB\-T\fR\ \fImax_ttl\fR] [\fB\-r\fR\ \fIrdir\fR\ [\fB\-S\fR\ \fIsdir\fR]]
.ad
.hy

.SH "DESCRIPTION"

.PP
 \fBrtpproxy\fR is a symmetric RTP proxy designed to be used in conjunction with the SIP Express Router (SER) or any other SIP proxy capable of rewriting SDP bodies in SIP messages that it processes\&.

.PP
The main purpose of rtpproxy is to make the communication between SIP user agents behind NAT(s) (Network Address Translator) possible\&. Several cases exists when direct end\-to\-end communication is not possible and RTP streams have to be relayed through another host\&. Rtpproxy can be used to setup such a relaying host\&.

.PP
When two listen interfaces have been specified using the command line parameters described below then rtpproxy will enter so called bridging mode\&. In briding mode rtpproxy forwards RTP packets received on one interface to the other interface and vice versa\&. This mode can be used to forward RTP packets between networks without direct network level connectivy (provided that the host running rtpproxy has one interface in both of them)\&. One particular application of bridging mode is IPv4/IPv6 traversal of RTP packets\&.

.PP
When instructured by SER rtpproxy can also record the entire RTP session in a file on a local harddisk or play a pre\-recorded file to the user agent (so called Music\-on\-Hold)\&.

.SH "OPTIONS"

.TP
\fB\-?\fR
Show summary of options\&.

.TP
\fB\-2\fR
Send every RTP packet twice in sessions that use low\-bitrate codecs\&. Only packets that are smaller than 128 bytes will be sent twice\&. This option can improve audio quality on lossy links\&.

.TP
\fB\-f\fR
Rtpproxy will stay in foreground mode if this option is set\&.

.TP
\fB\-v\fR
Show version of program\&.

.TP
\fB\-i\fR
Enable independent timeout mode\&.  In normal operation, a timeout (which results in automatic destruction of the session) can only occur if no packets are received on any of the session's ports\&.  This option varies that behaviour, such that a timeout will occur if packets are still being received on one port but not the other\&.

.TP
\fB\-l\fR \fIaddr1[/addr2]\fR
IPv4 listen IP address(es)\&. You can specify either one or two addresses\&. If two addresses have been specified then rtpproxy will work in bridging mode\&.

.TP
\fB\-6\fR \fIaddr1[/addr2]\fR
IPv6 listen IP address(es)\&. You can specify either one or two addresses\&. If two addresses have been specified then rtpproxy will work in bridging mode\&.

.TP
\fB\-s\fR \fIctrl_socket\fR
This parameter configures rtpproxy control socket\&. The control socket is used by nathelper module of SER to create/modify/delete RTP sessions to be relayed\&. Format of \fIctrl_socket\fR is <type>:<socket>\&. Following types are supported:

.RS
.TP 3
\(bu
 \fIudp:\fR Create UDP control socket\&. In this mode RTPProxy will listen on UDP for control messages from SER/nathelper\&.

Example: \-s udp:127\&.0\&.0\&.1:9000

IP address can be '*' in which case rtpproxy will listen on all local interfaces\&. If omitted port 22222 is used\&.

.RS
.Sh "Note"
RTPProxy control protocol has no built\-in security mechanisms\&. Make sure that you protect the listening IP and port properly when using RTPProxy with UDP control socket\&.

.RE
.TP
\(bu
 \fIudp6:\fR Create IPv6 UDP control socket\&. In this mode RTPProxy will listen on UDP/IPv6 for control messages from SER/nathelper\&.

Example: \-s udp6:::1:9000
.TP
\(bu
 \fIunix:\fR Create UNIX domain socket for control interface\&. In this mode SER/nathelper and RTPProxy must be running on the same host\&. This is the default setting for both SER/nathelper and rtpproxy\&.

Example: \-s unix:/var/run/rtpproxy\&.sock

Default value is \fI/var/run/rtpproxy\&.sock\fR\&.
.LP
.RE
.IP

.TP
\fB\-n\fR \fItimeout_socket\fR
This parameter configures the optional timeout notification socket\&.  The socket should be created by another application, preferably before starting rtpproxy\&.  For those sessions where the timeout mechanism is enabled, notifications are sent on this socket if the session times out\&. 

Example: \-n unix:/var/run/rtpproxy\&.timeout\&.sock

There is no default value, notifications are not sent and not permitted unless a value is specified explicitly\&.
.LP
.RE
.IP

.TP
\fB\-t\fR \fItos\fR
Set this ToS (Type of Service) in outgoing packets\&. Default value is 0xB8\&.

.TP
\fB\-r\fR \fIrec_dir\fR
Directory where recorded RTP sessions will be stored\&.

.TP
\fB\-S\fR \fIspool_dir\fR
Spool directory for RTP sessions being recorded\&. The file will be moved to directory configured in\fB\-r\fR option after the session finishes\&.

.TP
\fB\-R\fR
Do not record RTCP when recording an RTP session\&. This option is disabled (rtpproxy will record RTCP) by default\&.

.TP
\fB\-p\fR \fIpid_file\fR
This parameter configures the name of the file where PID of running rtpproxy will be stored\&. Default is\fI/var/run/rtpproxy\&.pid\fR\&.

.TP
\fB\-T\fR \fImax_ttl\fR
Limit the maximum TTL (Time To Live) of outgoing IP packets to the value of \fImax_ttl\fR\&.

.SH "HOWITWORKS"

.PP
When SER receives an INVITE request, it extracts Call\-ID from it and communicates it to rtpproxy via Unix domain socket or UDP\&. Rtproxy looks for an existing session with such Call\-ID\&. If the session exists it returns UDP port for that session, if not, then it creates a new session, binds to a first empty UDP port from the range specified at the compile time and returns number of that port to a SER\&. After receiving reply from the proxy, SER replaces media ip:port in the SDP to point to the proxy and forwards request as usually\&.

.PP
When SER receives a non\-negative SIP reply with SDP it again extracts Call\-ID from it and communicates it to the proxy\&. In this case the proxy does not allocate a new session if it doesn't exist, but simply performs a lookup among existing sessions and returns either a port number if the session is found, or error code indicating that there is no session with such id\&. After receiving positive reply from the proxy, SER replaces media ip:port in the SIP reply to point to the proxy and forwards reply as usually\&.

.PP
After the session has been created, the proxy listens on the port it has allocated for that session and waits for receiving at least one UDP packet from each of two parties participating in the call\&. Once such packet is received, the proxy fills one of two ip:port structures associated with each call with source ip:port of that packet\&. When both structures are filled in, the proxy starts relaying UDP packets between parties\&.

.PP
The proxy tracks idle time for each of existing sessions (i\&.e\&. the time within which there were no packets relayed), and automatically cleans up a sessions whose idle times exceed the value specified at compile time (60 seconds by default)\&.

.SH "FILES"

.PP
 \fI/usr/sbin/rtpproxy\fR 

.SH "LICENSE"

.PP
This program is licensed under the BSD license\&. See \fICOPYING\fR file in the rtpproxy sources for details\&.

.SH "AVAILABILITY"

.PP
The latest version of this program can be found at http://ftp\&.iptel\&.org/pub/rtpproxy: \fIhttp://ftp.iptel.org/pub/rtpproxy\fR\&.

.SH "SEEALSO"

.PP
ser(8)\&.

.SH AUTHOR
Maxim Sobolev.
